/*

 @Name：mBox v2.0 弹层组件移动版
 @Author：陈国军
 @Date：2015-11-28
 @官网：http://www.jayui.com/mBox/
        
*/
!function(a,b){function p(a,b,c,d,e){b&&b.parentNode?b.parentNode.insertBefore(a,b.nextSibling):c&&c.parentNode?c.parentNode.insertBefore(a,c):d&&d.appendChild(a),a.style.display="block"==e?"block":"none",this.backSitu=null}var g,j,k,l,m,n,h,i,o,q,c=function(a){return document.querySelectorAll(a)},d=document,e={};c.prototype,e.timer={},e.endfun={},e.extend=function(a,c,d){d===b&&(d=!0);for(var e in c)!d&&e in a||(a[e]=c[e]);return a},e.oneven=function(a,b){var c;return/Android|iPhone|SymbianOS|Windows Phone|iPad|iPod/.test(navigator.userAgent)?(a.addEventListener("touchmove",function(){c=!0},!1),a.addEventListener("touchend",function(a){a.preventDefault(),c||b.call(this,a),c=!1},!1),void 0):a.addEventListener("click",function(a){b.call(this,a)},!1)},g={width:"",height:"",boxtype:0,title:[],content:"请稍等,暂无内容！",conStyle:"background-color:#fff;",btnName:[],btnStyle:[],yesfun:null,nofun:null,closefun:null,closeBtn:[!1,1],time:null,fixed:!0,mask:!0,maskClose:!0,maskColor:"rgba(0,0,0,0.5)",margin:"10px 10px",zIndex:1e4,success:null,endfun:null},h=1,i=["jembox"],o=function(a){var b=this,c=JSON.parse(JSON.stringify(g));b.config=e.extend(c,a),j=b.config.content,j&&1===j.nodeType&&(n=document.defaultView.getComputedStyle(j,null).display,k=j.previousSibling,l=j.nextSibling,m=j.parentNode),b.viewInit()},o.prototype={viewInit:function(){var l,m,n,a=this,e=a.config,f=d.createElement("div"),g=e.mask?'<div class="jemboxmask" style="pointer-events:auto;background-color:'+e.maskColor+';"></div>':"",j=function(){var a="object"==typeof e.title,c=e.title[1]!=b?e.title[1]:"";return""!=e.title?'<div class="jemboxhead" id="head'+h+'" style="'+c+'">'+(a?e.title[0]:e.title)+"</div>":""}(),k=function(){var d,g,i,j,a=e.btnName,c=a.length,f="width:50%;";return 0!==c&&e.btnName?(1===c&&(g=""!=e.btnStyle?"width:100%;"+e.btnStyle[0].replace(/\s/g,""):"width:100%;",d='<span onytpe="1" style="'+g+'">'+a[0]+"</span>"),2===c&&(i=e.btnStyle[0]!=b?f+e.btnStyle[0]:f,j=e.btnStyle[1]!=b?f+e.btnStyle[1]:f,d='<span onytpe="0" style="'+j+'">'+a[1]+'</span><span onytpe="1" style="'+i+'">'+a[0]+"</span>"),'<div class="jemboxfoot" id="foot'+h+'">'+d+"</div>"):""}();c("html")[0].style.overflowY="hidden",c("body")[0].style.overflowY="hidden",l=""!=e.width?"width:"+e.width+";":"",m=""!=e.height?"height:"+e.height+";":"",a.id=f.id=i[0]+h,f.setAttribute("class","jemboxer "+i[0]+(e.boxtype||1)),f.setAttribute("style","z-index:"+e.zIndex),f.setAttribute("jmb",h),f.innerHTML=g+'<div class="jemboxmain" '+(e.fixed?"":'style="position:static;"')+'><div class="jemboxsection">'+'<div class="jemboxchild" style="'+l+m+e.conStyle+'">'+j+'<span class="jemboxclose0'+e.closeBtn[1]+'" style="display:'+(e.closeBtn[0]?"block":"none")+'"></span>'+'<div class="jemboxmcont" style="margin:'+e.margin+';"></div>'+k+"</div>"+"</div></div>",d.body.appendChild(f),n=a.elem=c("#"+a.id)[0],setTimeout(function(){try{c("#"+a.id+" .jemboxchild")[0].classList.add("jemboxanim")}catch(b){return}e.success&&e.success(n)},1),a.idx=h++,a.contype(e),a.action(e)},contype:function(e){var i,f=this,g=c("#"+f.id+" .jemboxmcont")[0],h=e.content;return f._elemBack&&f._elemBack(),h===b?g:("string"==typeof h?g.innerHTML=e.content:h&&1===h.nodeType&&(i=d.createElement("div"),"none"==a.getComputedStyle(h,null).display&&(h.style.display="block"),g.appendChild(i.appendChild(h))),void 0)},action:function(a){var d,f,g,h,b=this;if(a.time&&(e.timer[b.idx]=setTimeout(function(){q.close(b.idx)},1e3*a.time)),a.closeBtn[0]&&(d=c("#"+b.id+" .jemboxclose0"+a.closeBtn[1])[0],e.oneven(d,function(){a.closefun&&a.closefun(),q.close(b.idx)})),""!=a.btnName)for(f=c("#"+b.id+" .jemboxfoot")[0].children,g=0;g<f.length;g++)e.oneven(f[g],function(){var c=this.getAttribute("onytpe");0==c?a.nofun&&a.nofun():a.yesfun&&a.yesfun(b.idx),q.close(b.idx)});a.mask&&a.maskClose&&(h=c("#"+b.id+" .jemboxmask")[0],e.oneven(h,function(){q.close(b.idx,a.endfun)})),a.endfun&&(e.endfun[b.idx]=a.endfun)}},q={idx:h,cell:function(a){return c(a)[0]},open:function(a){var b=new o(a||{});return b.idx},close:function(a){var b=c("#jembox"+a)[0];b&&(j&&1===j.nodeType&&p(j,k,l,m,n),d.body.removeChild(b),c("html")[0].style.overflowY="",c("body")[0].style.overflowY="",clearTimeout(e.timer[h]),delete e.timer[h],"function"==typeof e.endfun[h]&&e.endfun[h](),delete e.endfun[h])},closeAll:function(){var b,a=c(".jemboxer");for(b=0;b<a.length;b++)q.close(a[b].getAttribute("jmb"))}},"function"==typeof define?define(function(){return q=mbox=$M=jemBox}):"object"==typeof module&&"object"==typeof module.exports?module.exports=q=$M=mbox=jemBox:a.mBox=$M=jemBox=mbox=q}(window);